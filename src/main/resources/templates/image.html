<!--Page for rendering the image/video for a specific date, along with its accompanying information (such as
the title, explanation, and the copyright info).

Author: Ryan Johnson-->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/index.css">
    <title>NASA Image of the Day</title>
</head>
<body>
    <h1 th:text="${image.date}" />
    <h2 th:text="${image.title}" />
    <input type="hidden" id="media-url" th:value="${image.url}">
    <div id="media-container" class="center"></div>

    <div class="center">
        <p class="bold inline">Media by: </p>
        <p class="inline center" th:text="${image.copyright}" id="copyright-text" />
    </div>

    <div class="margins">
        <p class="inline bold">Description: </p>
        <p class="inline" th:text="${image.explanation}" />
    </div>

    <h4 class="center margins">Choose another Day:
        <input class="inline" type="date" id="chosen-date" min="1995-06-16">
        <input class="inline center" onclick=getImagePage() type="submit" value="Submit">
    </h4>

    <script>
        // Upon submitting a date, the chosen date is appended to the URL, prompting a GET request to display the
        // data for that day.
        function getImagePage() {
            const dateChosen = document.getElementById("chosen-date").value;
            window.location.href = "/" + dateChosen;
        }

        // Changes the copyright text to "N/A" if no data is available for the chosen day.
        function setCopyrightMissingInfo() {
            if (`[[${image.copyright}]]` === "") {
                document.getElementById("copyright-text").textContent = "N/A";
            }
        }

        // Displays either the image or video for the chosen day, depending upon which the NASA API returns.
        function displayMedia() {
            const url = "[[${image.url}]]";
            const mediaContainer = document.getElementById("media-container");

            if (url && url.includes("youtube.com")) {
                const iframeElement = document.createElement("iframe");
                iframeElement.src = url;
                iframeElement.width = 640;
                iframeElement.height = 360;
                iframeElement.allowFullscreen = true;
                mediaContainer.appendChild(iframeElement);
            } else {
                const imgElement = document.createElement("img");
                imgElement.src = url;
                imgElement.alt = "${image.title}";
                imgElement.height = 350;
                mediaContainer.appendChild(imgElement);
            }
        }

        // Formats the selected date as YYYY-MM-DD. The base of this function was revamped from code generated '
        // by ChatGPT.
        function formatDate() {
            const date = new Date("[[${image.date}]]");

            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            const formattedDate = year + '-' + month + '-' + day;

            document.getElementById("chosen-date").setAttribute("value", formattedDate)
        }

        // Limits the latest possible date to the current date. The base of this function was revamped from
        // code generated by ChatGPT.
        function setMaxDate() {
            const currentDate = new Date();

            const day = String(currentDate.getDate()).padStart(2, '0');
            const month = String(currentDate.getMonth() + 1).padStart(2, '0');
            const year = currentDate.getFullYear();
            const formattedDate = year + '-' + month + '-' + day;

            document.getElementById("chosen-date").setAttribute("max", formattedDate)
        }

        setMaxDate();
        formatDate();
        displayMedia();
        setCopyrightMissingInfo();
    </script>
</body>
</html>
